:root {
  --bg: #0f1115;
  --panel: #141821;
  --panel-2: #0d1016;
  --muted: #8b93a7;
  --text: #e7eaf3;
  --accent: #4f6af2;
  --accent-2: #7a8cff;
  --border: #1f2430;
  --green: #1ec28b;
  --yellow: #f2c84b;
  --red: #ef5b5b;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius: 14px;
}
[data-theme="light"]{
  --bg:#f6f7fb; --panel:#ffffff; --panel-2:#f2f4f8; --muted:#657089; --text:#141821; --border:#e7eaf3; --shadow:0 8px 24px rgba(16,24,40,.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; background:var(--bg); color:var(--text); font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji"}

.app{display:grid; grid-template-columns: 260px 1fr 6px var(--chatWidth, 360px); gap:12px; height:100vh; padding:12px}
.app.chat-closed{grid-template-columns: 260px 1fr}
.panel{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
.sidebar{display:flex; flex-direction:column; padding:14px; gap:12px}
.prefs{display:grid; gap:8px}
.pref-item{display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--border); background:var(--panel-2); border-radius:10px; cursor:pointer; user-select:none}
.pref-item:hover{border-color:var(--accent)}
.pref-item:focus{outline:2px solid var(--accent)}
.profile{display:flex; align-items:center; gap:10px; padding:8px; border-radius:10px}
.avatar{width:34px; height:34px; background:linear-gradient(135deg,#5a83f2,#7b61ff); border-radius:50%; display:grid; place-items:center; font-weight:700}
.brand{font-weight:700}
.muted{color:var(--muted)}
.button{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border); background:var(--panel-2); color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer}
.button.sm{padding:6px 8px; font-size:12px}
.button.ghost{background:transparent}
.button.primary{background:var(--accent); border-color:transparent}
.section{margin:10px 0 6px; font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted)}
.nav-group{border:1px solid var(--border); border-radius:12px; overflow:hidden}
.nav-header{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:var(--panel-2); cursor:pointer}
.nav-items{display:grid}
.nav-item{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; gap:10px; border-top:1px solid var(--border); cursor:pointer}
.badge{font-size:12px; padding:2px 8px; background:var(--panel-2); border:1px solid var(--border); border-radius:999px}
.promo{margin-top:12px; padding:12px; display:grid; gap:8px; background:linear-gradient(180deg, rgba(79,106,242,.08), transparent)}
.meter{display:grid; gap:6px; margin-top:10px}
.meter .row{display:flex; align-items:center; justify-content:space-between; font-size:12px}
.bar{height:8px; background:var(--panel-2); border-radius:999px; overflow:hidden; border:1px solid var(--border)}
.bar > span{display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); width:0}
.bar[data-val="15"]>span{width:15%}
.bar[data-val="30"]>span{width:30%}
.bar[data-val="0"]>span{width:0%}
.spacer{flex:1}

/* MAIN */
.main{display:grid; grid-template-rows:auto 1fr; padding:10px; min-height:0; overflow:auto}
.topbar{display:flex; align-items:center; gap:10px}
.search{position:relative; flex:1}
.search input{width:100%; padding:12px 40px 12px 40px; border-radius:999px; background:var(--panel-2); border:1px solid var(--border); color:var(--text)}
.search svg{position:absolute; left:12px; top:50%; transform:translateY(-50%); width:18px; height:18px; opacity:.7}
.go-btn{position:absolute; right:8px; top:50%; transform:translateY(-50%); border-radius:999px; padding:8px 12px; border:1px solid var(--border); background:var(--panel-2); cursor:pointer}
.content{margin-top:10px; display:grid; grid-template-rows:auto 1fr}
.content-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; position:relative; z-index:60}
.title{display:flex; align-items:baseline; gap:10px}
.title h2{margin:0}
.view-controls{display:flex; align-items:center; gap:8px}
.view-controls, .view-controls *{pointer-events:auto}
.segmented{display:flex; border:1px solid var(--border); border-radius:999px; overflow:hidden}
.segmented button{padding:8px 12px; background:transparent; border:0; color:var(--text); cursor:pointer}
.segmented button.active{background:var(--panel-2)}

/* Styled selects for chat controls */
.select{appearance:none; -webkit-appearance:none; -moz-appearance:none; background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px 34px 8px 10px; position:relative}
.select-wrap{position:relative; display:inline-block}
.select-wrap:after{content:"▾"; position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none}

/* Shadcn-like glass select */
.select-glass{appearance:none; -webkit-appearance:none; -moz-appearance:none; background:rgba(20,24,33,.6); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 38px 10px 12px; backdrop-filter: blur(10px); box-shadow:0 2px 0 0 rgba(255,255,255,.03) inset}
.select-glass:focus{outline:2px solid rgba(122,140,255,.35); outline-offset:1px}
.select-glass-wrap{position:relative; display:inline-block}
.select-glass-wrap:after{content:"▾"; position:absolute; right:12px; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none}

.card-grid{margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;grid-auto-flow:row dense; align-items:start; align-content:start; justify-content:stretch}
.space-2col{grid-template-columns:1fr 1fr}
.space-2col .lib-card{max-width:none}
.lib-card{background:var(--panel-2); border:1px solid var(--border); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:12px; cursor:pointer; align-self:start; max-width:none}
.lib-visual{aspect-ratio:20/9; max-height:192px; border:1px dashed var(--border);border-radius:12px;display:grid;place-items:center;color:var(--muted);position:relative;overflow:hidden}
.card-title-overlay{position:absolute; left:8px; right:8px; bottom:8px; padding:6px 10px; border-radius:8px; background:rgba(0,0,0,.45); color:#fff; font-weight:600; backdrop-filter: blur(2px);}
.lib-meta{display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-size:12px}

/* LIST VIEW */
.list .card-grid{grid-template-columns:1fr}
.list .lib-card{display:grid; grid-template-columns:80px 1fr auto; align-items:center}
.list .lib-visual{height:60px}

/* RIGHT / CHAT */
.right{display:grid; grid-template-rows: 1fr auto; padding:14px; position:relative; z-index:20; min-height:0; overflow:visible}
.chat-side-hide{position:absolute; left:-52px; top:12px; transform:rotate(-90deg); transform-origin:left top; background:var(--panel); border:1px solid var(--border); color:var(--text); padding:6px 8px; border-radius:8px; cursor:pointer; opacity:.7}
.chat-side-hide:hover{opacity:1}
.chat-header{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px}
.chat-title{font-weight:700; color:var(--muted)}
.chat-header .button.sm{opacity:.7}
.chat-header .button.sm:hover{opacity:1}
.splitter{width:6px; cursor:col-resize; background:transparent; position:relative; z-index:35}
.splitter:after{content:""; position:absolute; left:2px; top:0; bottom:0; width:2px; background:var(--border)}
.app.chat-closed .splitter{display:none}
.stage{display:block; color:var(--muted); border:1px dashed var(--border); border-radius:14px}
.composer{margin-top:12px; padding:0; overflow:visible}
.composer-head{padding:12px 14px; border-bottom:1px solid var(--border); background:var(--panel-2); display:flex; align-items:center; justify-content:space-between}
.composer-body{padding:12px; display:grid; gap:8px}
.input{display:flex; align-items:center; gap:10px; border:1px solid var(--border); background:var(--panel); border-radius:12px; padding:8px}
.input input{flex:1; background:transparent; border:0; color:var(--text); outline:none; padding:8px}
.pill{font-size:12px; padding:6px 10px; background:var(--panel-2); border:1px solid var(--border); border-radius:999px; white-space:nowrap; flex-shrink:0; display:inline-flex; align-items:center; gap:6px; cursor:pointer}
#threadsList .thread-item{display:flex; align-items:center; justify-content:space-between; padding:10px; border:1px solid var(--border); background:var(--panel); border-radius:10px; cursor:pointer}
#threadsList .thread-item.active{background:var(--panel-2); border-color:var(--accent)}
#chatMessages{display:grid; align-content:start; gap:8px; overflow:auto}
.message{max-width:85%; padding:8px 10px; border-radius:10px; border:1px solid var(--border); word-wrap:break-word; white-space:pre-wrap}
.message.user{justify-self:end; background:var(--accent); color:#fff; border-color:transparent}
.message.assistant{justify-self:start; background:var(--panel-2)}
.message.assistant .md{line-height:1.5}
.message.assistant .md p{margin:0 0 8px}
.message.assistant .md ul{margin:6px 0 8px 18px}
.message.assistant .md code{background:var(--panel); border:1px solid var(--border); padding:2px 6px; border-radius:6px}
.message.assistant .md pre{background:var(--panel); border:1px solid var(--border); padding:8px 10px; border-radius:8px; overflow:auto}
.empty{color:var(--muted); text-align:center; padding:14px}

/* Model dropdown */
.input{position:relative}
.menu{position:absolute; right:0; top:calc(100% + 8px); width:220px; background:var(--panel); border:1px solid var(--border); border-radius:10px; box-shadow:var(--shadow); display:none; overflow:hidden; z-index:20}
.menu.open{display:grid}
.menu button{background:transparent; border:0; padding:10px 12px; color:var(--text); text-align:left; cursor:pointer}
.menu button:hover{background:var(--panel-2)}

/* RAG debug panel */
.rag-debug{margin-top:10px; padding:10px; background:var(--panel-2); border:1px dashed var(--border); border-radius:10px; color:var(--muted); font-size:12px; max-height:140px; overflow:auto; display:none}

/* Floating chat tab & scrim */
.chat-tab{display:none; position:fixed; right:6px; top:50%; transform:translateY(-50%); background:var(--panel); border:1px solid var(--border); border-right:0; color:var(--text); padding:10px 12px; border-radius:10px 0 0 10px; box-shadow:var(--shadow); align-items:center; gap:8px; cursor:pointer; z-index:30}
.chat-tab .icon{opacity:.9}
.app.chat-closed .chat-tab{display:flex}
.app.chat-closed .right{display:none}
.scrim{display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:10}
@media (min-width: 1201px){
  .app.chat-open #chatPanel{z-index:40}
  .app.chat-open #scrim{z-index:30}
  .app.chat-open .scrim{display:none}
}
.app.chat-open .scrim{display:none}

/* ICONS */
.icon{width:18px; height:18px; display:inline-block; vertical-align:middle}
.card-icon{width:28px; height:28px}

/* Tooltips (custom hover boxes) */
[data-tip]{position:relative}
[data-tip]::after{content:attr(data-tip); position:absolute; left:50%; bottom:calc(100% + 8px); transform:translateX(-50%); background:var(--panel); color:var(--text); border:1px solid var(--border); padding:6px 8px; border-radius:8px; box-shadow:var(--shadow); white-space:nowrap; font-size:12px; display:none; z-index:9999; pointer-events:none}
[data-tip]::before{content:""; position:absolute; left:50%; bottom:100%; transform:translateX(-50%); border-left:6px solid transparent; border-right:6px solid transparent; border-top:6px solid var(--panel); display:none; z-index:99; pointer-events:none}
[data-tip]:hover::after,[data-tip]:focus::after,[data-tip]:hover::before,[data-tip]:focus::before{display:block}
/* Ensure tooltips appear above panels and scrims */
.app *, .panel *, .scrim *{z-index:auto}
.tooltip-layer{z-index:9999}
@media (prefers-reduced-motion: no-preference){
  [data-tip]::after{opacity:0; transform:translateX(-50%) translateY(4px); transition:opacity .12s ease, transform .12s ease}
  [data-tip]:hover::after,[data-tip]:focus::after{opacity:1; transform:translateX(-50%) translateY(0)}
}

/* (removed) Floating controls for Deep Research */

/* Chats list rows */
.chat-row{display:flex; align-items:center; justify-content:space-between; border:1px solid var(--border); padding:4px 8px; border-radius:8px; height:34px; overflow:hidden; background:var(--panel)}
.chat-row:hover{background:var(--panel-2)}
.chat-row > div:first-child{min-width:0}
.chat-row .muted{font-size:11px}

/* Responsive */
@media (max-width: 1200px){
  .app{grid-template-columns: 220px 1fr 6px var(--chatWidth, 360px)}
  .app.chat-open .right{display:grid; position:relative; right:auto; top:auto; bottom:auto; width:auto; z-index:20}
  .app.chat-open #scrim{display:block; pointer-events:none}
}
@media (max-width: 780px){
  .app{grid-template-columns:1fr}
  .sidebar{display:none}
}

a { color: inherit; text-decoration: none; }
.kbd{font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: var(--panel-2); border:1px solid var(--border); padding:2px 6px; border-radius:6px}

/* Simple modal */
.modal-scrim{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:100}
.modal{width:min(520px, 92vw); background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); overflow:hidden}
/* Glassy, wider modal for pricing */
.pricing-modal{width:min(920px, 96vw); background:rgba(20,24,33,.6); border:1px solid rgba(231,234,243,.08); backdrop-filter: blur(14px) saturate(1.2); box-shadow:0 20px 50px rgba(0,0,0,.45)}
.modal-head{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; background:var(--panel-2); border-bottom:1px solid var(--border)}
.modal-body{padding:14px; display:grid; gap:10px}
.pricing{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
.price-card{padding:14px; border:1px solid rgba(231,234,243,.08); border-radius:14px; background:rgba(13,16,22,.55); backdrop-filter: blur(10px); box-shadow: inset 0 0 0 1px rgba(231,234,243,.04)}
/* Neutralize colored accents */
.price-free,.price-premium,.price-enterprise{box-shadow: inset 0 0 0 1px rgba(231,234,243,.04)}
.field{display:grid; gap:6px}
.field label{font-size:12px; color:var(--muted)}
.field input, .field textarea{background:transparent; border:1px solid var(--border); color:var(--text); padding:8px 10px; border-radius:8px}
.modal-actions{display:flex; justify-content:flex-end; gap:8px; padding:12px 14px; border-top:1px solid var(--border)}
.modal-show{display:flex}

/* Toasts */
.toasts{position:fixed; right:18px; bottom:18px; display:grid; gap:8px; z-index:200}
.toast{background:var(--panel); border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:10px; box-shadow:var(--shadow)}

/* Tour */
.tour-scrim{position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:300}
.tour-pop{position:absolute; display:grid; gap:8px; width:min(320px, 92vw); background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:12px; z-index:310}
.tour-pop::after{content:""; position:absolute; width:0; height:0}
.tour-pop.pos-right::after{left:-8px; top:14px; border-top:8px solid transparent; border-bottom:8px solid transparent; border-right:8px solid var(--panel)}
.tour-pop.pos-left::after{right:-8px; top:14px; border-top:8px solid transparent; border-bottom:8px solid transparent; border-left:8px solid var(--panel)}
.tour-pop.pos-top::after{left:14px; bottom:-8px; border-left:8px solid transparent; border-right:8px solid transparent; border-top:8px solid var(--panel)}
.tour-pop.pos-bottom::after{left:14px; top:-8px; border-left:8px solid transparent; border-right:8px solid transparent; border-bottom:8px solid var(--panel)}
.tour-head{display:flex; align-items:center; gap:8px; font-weight:700}
.tour-title{font-weight:700}
.tour-actions{display:flex; justify-content:flex-end; gap:8px}

/* Spotlight pulse */
@keyframes pulseRing{0%{box-shadow:0 0 0 0 rgba(122,140,255,.6)}70%{box-shadow:0 0 0 10px rgba(122,140,255,0)}100%{box-shadow:0 0 0 0 rgba(122,140,255,0)}}
.tour-spot{position:absolute; pointer-events:none; border:2px solid var(--accent); border-radius:12px; z-index:305; animation:pulseRing 1.6s ease-out infinite}

/* Notes editor */
.note-row{border:1px solid var(--border); border-radius:10px; padding:10px; background:var(--panel); display:grid; gap:8px}
.note-head{display:flex; align-items:center; justify-content:space-between; gap:10px}
.note-title{flex:1; background:transparent; border:1px solid var(--border); border-radius:8px; padding:8px; color:var(--text)}
.note-controls{display:flex; align-items:center; gap:8px}
.note-body{display:grid; gap:10px}
.note-body.split{grid-template-columns:1fr 1fr}
.note-body.edit{grid-template-columns:1fr}
.note-body.preview{grid-template-columns:1fr}
.note-editor{width:100%; min-height:320px; background:transparent; border:1px solid var(--border); border-radius:8px; padding:10px; color:var(--text); resize:vertical}
.note-preview{border:1px solid var(--border); border-radius:8px; padding:12px; background:var(--panel-2); overflow:auto}
.note-body.edit .note-preview{display:none}
.note-body.preview .note-editor{display:none}
.note-fullscreen{position:fixed; inset:18px; z-index:70; background:var(--panel); box-shadow:var(--shadow); overflow:auto}
.note-fullscreen .note-editor{min-height:60vh}

/* Collapsed note styles */
.note-snippet{color:var(--muted); background:var(--panel-2); border:1px solid var(--border); border-radius:8px; padding:10px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; line-height:1.4; cursor:pointer}
.note-row.collapsed .note-body{display:none}
.note-row.collapsed [data-mode], .note-row.collapsed [data-fullscreen]{display:none}
.note-row.collapsed .note-title{pointer-events:none; opacity:.9}
.note-row:not(.collapsed) .note-snippet{display:none}

.chat-root{display:grid; grid-template-rows: 1fr auto auto; gap:10px; min-height:0}
#chatMessages{min-height:0}
