:root {
  --bg: #0f1115;
  --panel: #141821;
  --panel-2: #0d1016;
  --muted: #8b93a7;
  --text: #e7eaf3;
  --accent: #4f6af2;
  --accent-2: #7a8cff;
  --border: #1f2430;
  --green: #1ec28b;
  --yellow: #f2c84b;
  --red: #ef5b5b;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius: 14px;
}
[data-theme="light"]{
  --bg:#f6f7fb; --panel:#ffffff; --panel-2:#f2f4f8; --muted:#657089; --text:#141821; --border:#e7eaf3; --shadow:0 8px 24px rgba(16,24,40,.08);
}
/* Shadcn-inspired palettes */
[data-theme="slate"]{
  --bg:#0b1220; --panel:#0f172a; --panel-2:#0b1220; --muted:#94a3b8; --text:#e2e8f0; --border:#1e293b; --accent:#7c3aed; --accent-2:#a78bfa;
}
[data-theme="zinc"]{
  --bg:#0c0c0f; --panel:#111113; --panel-2:#0c0c0f; --muted:#a1a1aa; --text:#fafafa; --border:#27272a; --accent:#3b82f6; --accent-2:#93c5fd;
}
[data-theme="rose"]{
  --bg:#111014; --panel:#17141a; --panel-2:#120f15; --muted:#fda4af; --text:#ffe4e6; --border:#27212b; --accent:#e11d48; --accent-2:#fb7185;
}
[data-theme="emerald"]{
  --bg:#071410; --panel:#0a1a15; --panel-2:#071410; --muted:#a7f3d0; --text:#ecfdf5; --border:#113026; --accent:#10b981; --accent-2:#34d399;
}
[data-theme="amber"]{
  --bg:#141206; --panel:#1b1708; --panel-2:#141206; --muted:#fcd34d; --text:#fef3c7; --border:#312a11; --accent:#f59e0b; --accent-2:#fbbf24;
}
[data-theme="indigo"]{
  --bg:#0e1024; --panel:#14173a; --panel-2:#0e1024; --muted:#c7d2fe; --text:#eef2ff; --border:#1e2160; --accent:#6366f1; --accent-2:#818cf8;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; background:var(--bg); color:var(--text); font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji"}
.mobile-only{display:none}

.app{display:grid; grid-template-columns: 260px 1fr 6px var(--chatWidth, 360px); gap:12px; height:100vh; padding:12px; overflow:hidden}
.app.chat-closed{grid-template-columns: 260px 1fr}
.mobile-header{display:none; align-items:center; justify-content:space-between; gap:8px; position:sticky; top:0; z-index:50; padding:10px 12px; background:var(--panel); border-bottom:1px solid var(--border)}
.mobile-header .brand{font-weight:700}
.mobile-header .button{padding:8px 10px}
.panel{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
.sidebar{display:flex; flex-direction:column; padding:14px; gap:12px; overflow-y:auto; height:100%}
.prefs{display:grid; gap:8px}
.pref-item{display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid var(--border); background:var(--panel-2); border-radius:10px; cursor:pointer; user-select:none}
.pref-item:hover{border-color:var(--accent)}
.pref-item:focus{outline:2px solid var(--accent)}
.profile{display:flex; align-items:center; gap:10px; padding:8px; border-radius:10px}
.avatar{width:34px; height:34px; background:linear-gradient(135deg,#5a83f2,#7b61ff); border-radius:50%; display:grid; place-items:center; font-weight:700}
.brand{font-weight:700}
.muted{color:var(--muted)}
.button{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)), var(--panel-2); color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer; white-space:nowrap; box-shadow:0 1px 0 rgba(255,255,255,.03) inset}
.button.sm{padding:6px 8px; font-size:12px}
.button.ghost{background:transparent}
.button.primary{background:var(--accent); border-color:transparent}
.section{margin:10px 0 6px; font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted)}
.nav-group{border:1px solid var(--border); border-radius:12px; overflow:hidden}
.nav-header{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:var(--panel-2); cursor:pointer}
.nav-items{display:grid}
.nav-item{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; gap:10px; border-top:1px solid var(--border); cursor:pointer}
.badge{font-size:12px; padding:2px 8px; background:var(--panel-2); border:1px solid var(--border); border-radius:999px}
.promo{margin-top:12px; padding:12px; display:grid; gap:8px; background:linear-gradient(180deg, rgba(79,106,242,.08), transparent)}
.meter{display:grid; gap:6px; margin-top:10px}
.meter .row{display:flex; align-items:center; justify-content:space-between; font-size:12px}
.bar{height:8px; background:var(--panel-2); border-radius:999px; overflow:hidden; border:1px solid var(--border)}
.bar > span{display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2)); width:0}
.bar[data-val="15"]>span{width:15%}
.bar[data-val="30"]>span{width:30%}
.bar[data-val="0"]>span{width:0%}
.spacer{flex:1}

/* MAIN */
.main{display:grid; grid-template-rows:auto 1fr; padding:10px; min-height:0; overflow:hidden; height:100%}
.topbar{display:flex; align-items:center; gap:10px}
.search{position:relative; flex:1}
.search input{width:100%; padding:12px 40px 12px 40px; border-radius:999px; background:var(--panel-2); border:1px solid var(--border); color:var(--text)}
.search svg{position:absolute; left:12px; top:50%; transform:translateY(-50%); width:18px; height:18px; opacity:.7}
.go-btn{position:absolute; right:8px; top:50%; transform:translateY(-50%); border-radius:999px; padding:8px 12px; border:1px solid var(--border); background:var(--panel-2); cursor:pointer}
.content{margin-top:10px; display:grid; grid-template-rows:auto 1fr; overflow-y:auto; min-height:0}
.content-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; position:relative; z-index:60}
.title{display:flex; align-items:baseline; gap:10px}
.title h2{margin:0}
.view-controls{display:flex; align-items:center; gap:8px}
.view-controls, .view-controls *{pointer-events:auto}
.segmented{display:flex; border:1px solid var(--border); border-radius:999px; overflow:hidden}
.segmented button{padding:8px 12px; background:transparent; border:0; color:var(--text); cursor:pointer}
.segmented button.active{background:var(--panel-2)}

/* Styled selects for chat controls */
.select{appearance:none; -webkit-appearance:none; -moz-appearance:none; background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px 34px 8px 10px; position:relative}
.select-wrap{position:relative; display:inline-block}
.select-wrap:after{content:"▾"; position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none}
.select-wrap.select-wrap--enhanced:after{display:none}

/* Ensure native selects inside modals are clipped correctly and size nicely */
.modal .field select{background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px; width:100%}
.modal .field select:focus{outline:2px solid rgba(122,140,255,.35); outline-offset:1px}

/* Shadcn-like glass select */
.select-glass{appearance:none; -webkit-appearance:none; -moz-appearance:none; background:rgba(20,24,33,.6); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 38px 10px 12px; backdrop-filter: blur(10px); box-shadow:0 2px 0 0 rgba(255,255,255,.03) inset}
.select-glass:focus{outline:2px solid rgba(122,140,255,.35); outline-offset:1px}
.select-glass-wrap{position:relative; display:inline-block}
.select-glass-wrap:after{content:"▾"; position:absolute; right:12px; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none}

.card-grid{margin-top:12px;display:flex;flex-wrap:wrap;gap:12px;align-items:stretch;align-content:flex-start;justify-content:flex-start}
.space-2col{grid-template-columns:1fr 1fr}
.space-1col{grid-template-columns:1fr}
.space-2col .lib-card{max-width:none}
.lib-card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)), var(--panel-2); border:1px solid var(--border); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:12px; align-self:start; width:300px; box-shadow:0 1px 0 rgba(255,255,255,.03) inset}
.lib-card.collapsed{padding:12px}
.lib-card.collapsed #filesList{display:none}
.lib-card.collapsed #filesActions{display:none}
.lib-visual{aspect-ratio:16/9; max-height:180px; border:1px dashed var(--border);border-radius:12px;display:grid;place-items:center;color:var(--muted);position:relative;overflow:hidden}
.lib-visual img{width:100%; height:100%; object-fit:cover; display:block; border-radius:12px}
.lib-visual .card-icon{width:72px; height:72px}
.card-title-overlay{position:absolute; left:8px; right:8px; bottom:8px; padding:6px 10px; border-radius:8px; background:rgba(0,0,0,.45); color:#fff; font-weight:600; backdrop-filter: blur(2px);}
.lib-meta{display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-size:12px}

/* LIST VIEW */
.list .card-grid{grid-template-columns:1fr}
.list .lib-card{display:grid; grid-template-columns:80px 1fr auto; align-items:center}
.list .lib-visual{height:60px}

/* RIGHT / CHAT */
.right{display:grid; grid-template-rows: 1fr auto; padding:14px; position:relative; z-index:20; min-height:0; overflow:visible}
.chat-side-hide{position:absolute; left:-52px; top:12px; transform:rotate(-90deg); transform-origin:left top; background:var(--panel); border:1px solid var(--border); color:var(--text); padding:6px 8px; border-radius:8px; cursor:pointer; opacity:.7}
.chat-side-hide:hover{opacity:1}
.chat-header{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px}
.chat-title{font-weight:700; color:var(--muted)}
.chat-header .button.sm{opacity:.7}
.chat-header .button.sm:hover{opacity:1}
.splitter{width:6px; cursor:col-resize; background:transparent; position:relative; z-index:35}
.splitter:after{content:""; position:absolute; left:2px; top:0; bottom:0; width:2px; background:var(--border)}
.app.chat-closed .splitter{display:none}
.stage{display:block; color:var(--muted); border:1px dashed var(--border); border-radius:14px}
.composer{margin-top:12px; padding:0; overflow:visible}
.composer-head{padding:12px 14px; border-bottom:1px solid var(--border); background:var(--panel-2); display:flex; align-items:center; justify-content:space-between}
.composer-body{padding:12px; display:grid; gap:8px}
.input{display:flex; align-items:center; gap:10px; border:1px solid var(--border); background:var(--panel); border-radius:12px; padding:8px}
.input input{flex:1; background:transparent; border:0; color:var(--text); outline:none; padding:8px}
.pill{font-size:12px; padding:6px 10px; background:var(--panel-2); border:1px solid var(--border); border-radius:999px; white-space:nowrap; flex-shrink:0; display:inline-flex; align-items:center; gap:6px; cursor:pointer}
#threadsList .thread-item{display:flex; align-items:center; justify-content:space-between; padding:10px; border:1px solid var(--border); background:var(--panel); border-radius:10px; cursor:pointer}
#threadsList .thread-item.active{background:var(--panel-2); border-color:var(--accent)}
#chatMessages{display:grid; align-content:start; gap:8px; overflow:auto}
.message{max-width:85%; padding:8px 10px; border-radius:10px; border:1px solid var(--border); word-wrap:break-word; white-space:pre-wrap}
.message.user{justify-self:end; background:var(--accent); color:#fff; border-color:transparent}
.message.assistant{justify-self:start; background:var(--panel-2)}
.message.assistant .md{line-height:1.5}
.message.assistant .md p{margin:0 0 8px}
.message.assistant .md ul{margin:6px 0 8px 18px}
.message.assistant .md code{background:var(--panel); border:1px solid var(--border); padding:2px 6px; border-radius:6px}
.message.assistant .md pre{background:var(--panel); border:1px solid var(--border); padding:8px 10px; border-radius:8px; overflow:auto}
.empty{color:var(--muted); text-align:center; padding:14px}

/* Model dropdown */
.input{position:relative}
.menu{position:absolute; right:0; top:calc(100% + 8px); width:220px; background:var(--panel); border:1px solid var(--border); border-radius:10px; box-shadow:var(--shadow); display:none; overflow:hidden; z-index:20}
.menu.open{display:grid}
.menu button{background:transparent; border:0; padding:10px 12px; color:var(--text); text-align:left; cursor:pointer}
.menu button:hover{background:var(--panel-2)}

/* RAG debug panel */
.rag-debug{margin-top:10px; padding:10px; background:var(--panel-2); border:1px dashed var(--border); border-radius:10px; color:var(--muted); font-size:12px; max-height:140px; overflow:auto; display:none}

/* Floating chat tab & scrim */
.chat-tab{display:none; position:fixed; right:6px; top:50%; transform:translateY(-50%); background:var(--panel); border:1px solid var(--border); border-right:0; color:var(--text); padding:10px 12px; border-radius:10px 0 0 10px; box-shadow:var(--shadow); align-items:center; gap:8px; cursor:pointer; z-index:30}
.chat-tab .icon{opacity:.9}
.app.chat-closed .chat-tab{display:flex}
.app.chat-closed .right{display:none !important}
.scrim{display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:10}
@media (min-width: 1201px){
  .app.chat-open #chatPanel{z-index:40}
  .app.chat-open #scrim{z-index:30}
  .app.chat-open .scrim{display:none}
}
.app.chat-open .scrim{display:none}

/* ICONS */
.icon{width:18px; height:18px; display:inline-block; vertical-align:middle}
.card-icon{width:28px; height:28px}

/* Tooltips (custom hover boxes) */
[data-tip]{position:relative}
[data-tip]::after{content:attr(data-tip); position:absolute; left:50%; bottom:calc(100% + 8px); transform:translateX(-50%); background:var(--panel); color:var(--text); border:1px solid var(--border); padding:6px 8px; border-radius:8px; box-shadow:var(--shadow); white-space:nowrap; font-size:12px; display:none; z-index:999999; pointer-events:none}
[data-tip]::before{content:""; position:absolute; left:50%; bottom:100%; transform:translateX(-50%); border-left:6px solid transparent; border-right:6px solid transparent; border-top:6px solid var(--panel); display:none; z-index:999998; pointer-events:none}
[data-tip]:hover::after,[data-tip]:focus::after,[data-tip]:hover::before,[data-tip]:focus::before{display:block}
/* Ensure tooltips appear above panels and scrims */
.app *, .panel *, .scrim *{z-index:auto}
.tooltip-layer{z-index:99999}

/* Force tooltips to break out of stacking contexts */
[data-tip]{position:relative; z-index:999999}
[data-tip]::after, [data-tip]::before{z-index:999999!important}
@media (prefers-reduced-motion: no-preference){
  [data-tip]::after{opacity:0; transform:translateX(-50%) translateY(4px); transition:opacity .12s ease, transform .12s ease}
  [data-tip]:hover::after,[data-tip]:focus::after{opacity:1; transform:translateX(-50%) translateY(0)}
}

/* (removed) Floating controls for Deep Research */

/* Chats list rows */
.chat-row{display:flex; align-items:center; justify-content:space-between; border:1px solid var(--border); padding:4px 8px; border-radius:8px; height:34px; overflow:hidden; background:var(--panel)}
.chat-row:hover{background:var(--panel-2)}
.chat-row > div:first-child{min-width:0}
.chat-row .muted{font-size:11px}

/* Responsive */
@media (max-width: 1200px){
  .app{grid-template-columns: 220px 1fr 6px var(--chatWidth, 360px)}
  .app.chat-open .right{display:grid; position:relative; right:auto; top:auto; bottom:auto; width:auto; z-index:20}
  .app.chat-open #scrim{display:block; pointer-events:none}
}
@media (max-width: 780px){
  .app{grid-template-columns:1fr}
  .sidebar{display:none}
  .app.chat-open .main{display:none}
  .app.chat-open .right{display:grid}
  .mobile-only{display:inline-flex !important}
  .mobile-header{display:flex}
  /* Hide desktop-only controls on mobile */
  .hide-mobile,.mobile-hidden{display:none !important}
  .segmented{display:none}
  /* Make space content single-column on mobile */
  .card-grid{grid-template-columns:1fr}
  /* Full-screen stack panels in space view */
  #spaceTabs{display:flex; gap:8px; padding:8px 0}
  #spaceTabs .button{flex:1; justify-content:center}
  .lib-card{display:none}
  .lib-card.mobile-open{display:flex; max-height:calc(100vh - 180px); overflow:auto}
  .lib-card.mobile-open .note-editor,.lib-card.mobile-open .note-rich,.lib-card.mobile-open #filesList{min-height:calc(100vh - 240px)}
  .content-head{display:none}
}

/* Mobile drawer */
.mobile-drawer{position:fixed; inset:0 30% 0 0; transform:translateX(-100%); background:var(--panel); border-right:1px solid var(--border); z-index:80; display:flex; flex-direction:column; padding:12px; gap:8px; transition:transform .2s ease}
.mobile-drawer.open{transform:translateX(0)}
.mobile-scrim{position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:70; display:none}
.mobile-scrim.show{display:block}

a { color: inherit; text-decoration: none; }
.kbd{font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: var(--panel-2); border:1px solid var(--border); padding:2px 6px; border-radius:6px}

/* Simple modal */
.modal-scrim{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:100}
.modal{width:min(520px, 92vw); background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); overflow:hidden}
/* Glassy, wider modal for pricing */
.pricing-modal{width:min(920px, 96vw); background:rgba(20,24,33,.6); border:1px solid rgba(231,234,243,.08); backdrop-filter: blur(14px) saturate(1.2); box-shadow:0 20px 50px rgba(0,0,0,.45)}
.modal-head{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; background:var(--panel-2); border-bottom:1px solid var(--border)}
.modal-body{padding:14px; display:grid; gap:10px}
.pricing{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
.price-card{padding:14px; border:1px solid rgba(231,234,243,.08); border-radius:14px; background:rgba(13,16,22,.55); backdrop-filter: blur(10px); box-shadow: inset 0 0 0 1px rgba(231,234,243,.04)}
/* Neutralize colored accents */
.price-free,.price-premium,.price-enterprise{box-shadow: inset 0 0 0 1px rgba(231,234,243,.04)}
.field{display:grid; gap:6px}
.field label{font-size:12px; color:var(--muted)}
.field input, .field textarea{background:transparent; border:1px solid var(--border); color:var(--text); padding:8px 10px; border-radius:8px}
.modal-actions{display:flex; justify-content:flex-end; gap:8px; padding:12px 14px; border-top:1px solid var(--border)}
.modal-show{display:flex}

/* Destructive button style */
.button.red{background:transparent; border-color: var(--red); color: var(--red)}
.button.red:hover{background: rgba(239,91,91,.1)}
.button[disabled]{opacity:.5; cursor:not-allowed}

/* Text truncation helpers */
.truncate{white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.flex-1{flex:1; min-width:0}

/* Toasts */
.toasts{position:fixed; right:18px; bottom:18px; display:grid; gap:8px; z-index:200}
.toast{background:var(--panel); border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:10px; box-shadow:var(--shadow)}
.toast.success{border-color: var(--green)}
.toast.error{border-color: var(--red)}
.progress-row{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px}
.progress-bar{height:8px; border:1px solid var(--border); background:var(--panel-2); border-radius:999px; overflow:hidden}
.progress-bar > span{display:block; height:100%; background:linear-gradient(90deg, var(--accent), var(--accent-2)); width:0}
.progress-bar.indeterminate > span{width:40%; animation:indet 1.2s ease-in-out infinite}
@keyframes indet{0%{margin-left:-40%}50%{margin-left:30%}100%{margin-left:100%}}

/* Tour */
.tour-scrim{position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:300}
.tour-pop{position:absolute; display:grid; gap:8px; width:min(320px, 92vw); background:var(--panel); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:12px; z-index:310}
.tour-pop::after{content:""; position:absolute; width:0; height:0}
.tour-pop.pos-right::after{left:-8px; top:14px; border-top:8px solid transparent; border-bottom:8px solid transparent; border-right:8px solid var(--panel)}
.tour-pop.pos-left::after{right:-8px; top:14px; border-top:8px solid transparent; border-bottom:8px solid transparent; border-left:8px solid var(--panel)}
.tour-pop.pos-top::after{left:14px; bottom:-8px; border-left:8px solid transparent; border-right:8px solid transparent; border-top:8px solid var(--panel)}
.tour-pop.pos-bottom::after{left:14px; top:-8px; border-left:8px solid transparent; border-right:8px solid transparent; border-bottom:8px solid var(--panel)}
.tour-head{display:flex; align-items:center; gap:8px; font-weight:700}
.tour-title{font-weight:700}
.tour-actions{display:flex; justify-content:flex-end; gap:8px}

/* Spotlight pulse */
@keyframes pulseRing{0%{box-shadow:0 0 0 0 rgba(122,140,255,.6)}70%{box-shadow:0 0 0 10px rgba(122,140,255,0)}100%{box-shadow:0 0 0 0 rgba(122,140,255,0)}}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.spinning{animation:spin 1s linear infinite}
.tour-spot{position:absolute; pointer-events:none; border:2px solid var(--accent); border-radius:12px; z-index:305; animation:pulseRing 1.6s ease-out infinite}

/* Notes editor */
.note-row{border:1px solid var(--border); border-radius:10px; padding:10px; background:var(--panel); display:grid; gap:8px}
.note-head{display:flex; align-items:center; justify-content:space-between; gap:10px}
.note-title{flex:1; background:transparent; border:1px solid var(--border); border-radius:8px; padding:8px; color:var(--text)}
.note-controls{display:flex; align-items:center; gap:8px}
.note-body{display:grid; gap:10px}
.note-body.split{grid-template-columns:1fr 1fr}
.note-body.edit{grid-template-columns:1fr}
.note-body.preview{grid-template-columns:1fr}
.note-editor{width:100%; min-height:320px; background:transparent; border:1px solid var(--border); border-radius:8px; padding:10px; color:var(--text); resize:vertical}
.note-preview{border:1px solid var(--border); border-radius:8px; padding:12px; background:var(--panel-2); overflow:auto}
.note-body.edit .note-preview{display:none}
.note-body.preview .note-editor{display:none}
.note-rich{min-height:240px; border:1px solid var(--border); border-radius:8px; padding:10px; background:var(--panel); color:var(--text); outline:none}
.note-rich{line-height:1.65}
.note-rich p{margin:0 0 10px}
.note-rich a{color:var(--accent); text-decoration:underline}
.note-rich ul{list-style:disc; padding-left:22px; margin:8px 0}
.note-rich ol{list-style:decimal; padding-left:22px; margin:8px 0}
.note-rich li{margin:4px 0}
.note-body.rich .note-editor{display:none}
.note-body.rich .note-preview{display:none}
.rich-toolbar{display:flex; flex-wrap:wrap; gap:6px; margin-bottom:6px}
.rich-toolbar .button{padding:6px 8px; font-size:12px}
/* Rich content styles */
.note-rich h1{font-size:22px; margin:10px 0}
.note-rich h2{font-size:18px; margin:10px 0}
.note-rich h3{font-size:16px; margin:8px 0}
.note-rich blockquote{margin:8px 0; padding:6px 10px; border-left:3px solid var(--accent); background:var(--panel-2); border-radius:6px}
.note-rich pre{background:var(--panel-2); border:1px solid var(--border); padding:10px; border-radius:8px; overflow:auto; font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
.note-rich code{background:var(--panel-2); border:1px solid var(--border); padding:2px 4px; border-radius:6px}
.note-rich table{width:100%; border-collapse:collapse; margin:10px 0}
.note-rich th,.note-rich td{border:1px solid var(--border); padding:6px 8px}
.note-rich th{background:var(--panel-2); font-weight:600}
.note-rich hr{border:0; height:1px; background:var(--border); margin:12px 0}
.note-fullscreen{position:fixed; inset:18px; z-index:70; background:var(--panel); box-shadow:var(--shadow); overflow:auto}
.note-fullscreen .note-editor{min-height:60vh}

/* Collapsed note styles */
.note-snippet{color:var(--muted); background:var(--panel-2); border:1px solid var(--border); border-radius:8px; padding:10px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; line-height:1.4; cursor:pointer}
.note-row.collapsed .note-body{display:none}
.note-row.collapsed [data-mode], .note-row.collapsed [data-fullscreen]{display:none}
.note-row.collapsed .note-title{pointer-events:none; opacity:.9}
.note-row:not(.collapsed) .note-snippet{display:none}

.chat-root{display:grid; grid-template-rows: auto 1fr auto auto; gap:0; min-height:0; height:100%; overflow:hidden}
#chatMessages{min-height:0; overflow-y:auto}

/* Chat panel specific styling */
#chatPanel{height:100%; overflow:hidden; display:flex; flex-direction:column; transition: all 0.3s ease}
#chatRoot{flex:1; min-height:0; overflow:hidden}

/* Chat header styling */
.chat-header{
  border-bottom: 1px solid var(--border) !important;
  margin-bottom: 0 !important;
}

/* Chat collapse functionality */
.app.chat-panel-collapsed{
  grid-template-columns: 260px 1fr 6px 50%;
}
.app.chat-closed.chat-panel-collapsed{
  grid-template-columns: 260px 1fr;
}
#chatPanel.chat-collapsed .chat-root{
  grid-template-rows: auto 1fr;
}
#chatPanel.chat-collapsed #chatMessages{
  border-radius: 0 0 12px 12px;
}
#chatPanel.chat-collapsed .composer{
  display: none !important;
}
#chatPanel.chat-collapsed .rag-debug{
  display: none !important;
}

/* Shadcn-like custom select */
.ui-select{position:relative; display:inline-block}
.ui-select-trigger{display:flex; align-items:center; justify-content:space-between; gap:8px; width:100%; background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px 10px; cursor:pointer}
.ui-select-trigger:focus{outline:2px solid var(--accent)}
.ui-select-caret{color:var(--muted)}
.ui-select-menu{position:absolute; left:0; right:auto; top:calc(100% + 6px); background:var(--panel); border:1px solid var(--border); border-radius:10px; box-shadow:var(--shadow); display:none; overflow:auto; max-height:260px; z-index:140}
.ui-select.open .ui-select-menu{display:block}
.ui-option{padding:8px 10px; white-space:nowrap; cursor:pointer}
.ui-option[aria-selected="true"]{background:var(--panel-2)}
.ui-option:hover{background:var(--panel-2)}

/* Open upwards state */
.ui-select.drop-up .ui-select-menu{bottom:calc(100% + 6px); top:auto}

/* Themed, thin scrollbars (modern browsers) */
*{scrollbar-width: thin; scrollbar-color: var(--border) transparent}
::-webkit-scrollbar{width:10px; height:10px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:linear-gradient(180deg, var(--panel-2), var(--panel)); border:1px solid var(--border); border-radius:999px}
::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg, var(--panel-2), var(--panel-2))}

/* Meetings Hub Styles */
.meetings-hub { padding: 24px; max-width: 1400px; margin: 0 auto; }
.hub-header { display: flex; justify-content: flex-start; align-items: center; gap: 16px; margin-bottom: 32px; }
.hub-header h1 { margin: 0; font-size: 32px; }
.hub-actions { display: flex; gap: 12px; justify-content: flex-start; flex-wrap: wrap; }
.hub-actions .button { min-width: 180px; }
.insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
.insight-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
.insight-card h4 { margin: 0 0 8px; color: var(--muted); font-size: 14px; }
.insight-card p { margin: 0; font-size: 28px; font-weight: 600; }
.meetings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 16px; }
.meeting-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; }
.card-header { padding: 20px 20px 12px; display: flex; justify-content: space-between; align-items: start; }
.card-title { margin: 0; font-size: 18px; color: var(--text); }
.card-meta { display: flex; gap: 16px; padding: 0 20px 12px; color: var(--muted); font-size: 13px; }
.card-meta span { display: flex; align-items: center; gap: 6px; }
.icon-sm { width: 14px; height: 14px; }
.card-preview { padding: 0 20px 16px; margin: 0; color: var(--text-secondary); font-size: 14px; line-height: 1.5; flex-grow: 1; }
.card-actions { padding: 12px 20px; border-top: 1px solid var(--border); background: var(--panel-2); display: flex; gap: 8px; }
.empty-state, .loading, .error-state { padding: 48px; text-align: center; color: var(--muted); }
.error-state { color: var(--red); }

/* Transcript Modal */
.transcript-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
.modal-content-wrapper { background: var(--panel); width: min(80vw, 900px); max-height: 85vh; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border); }
.transcript-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid var(--border); background: var(--panel-2); }
.transcript-header h2 { margin: 0; }
.transcript-body { overflow-y: auto; }
.speaker-legend { padding: 16px 24px; background: var(--panel-2); display: flex; gap: 20px; flex-wrap: wrap; border-bottom: 1px solid var(--border); }
.speaker-item { display: flex; align-items: center; gap: 8px; }
.speaker-color { width: 12px; height: 12px; border-radius: 50%; }
.transcript-content { padding: 24px; }
.transcript-segment { display: flex; margin-bottom: 20px; }
.segment-color-bar { width: 4px; margin-right: 16px; border-radius: 4px; }
.segment-text { }
.segment-speaker { font-weight: 600; margin-bottom: 4px; }
.segment-message { line-height: 1.6; }
.transcript-fallback { padding: 24px; }
.transcript-fallback pre { white-space: pre-wrap; word-break: break-all; }

/* Speaker Identification Styles */
.speaker-modal {
  max-width: 500px;
  padding: 0;
}

.modal-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-light, #e0e0e0);
}

.modal-header h3 {
  margin: 0 0 8px 0;
  font-size: 18px;
  font-weight: 600;
}

.modal-subtitle {
  margin: 0;
  color: var(--text-muted, #666);
  font-size: 14px;
}

.speaker-fields {
  padding: 20px 24px;
  max-height: 400px;
  overflow-y: auto;
}

.speaker-field {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding: 12px;
  background: var(--bg-subtle, #f9f9f9);
  border-radius: 8px;
  border: 1px solid var(--border-light, #e0e0e0);
}

.speaker-label {
  min-width: 80px;
  font-weight: 500;
  color: var(--primary, #2196F3);
  font-size: 14px;
}

.speaker-inputs {
  flex: 1;
  display: flex;
  gap: 8px;
}

.speaker-inputs input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid var(--border, #ddd);
  border-radius: 4px;
  font-size: 14px;
  background: white;
}

.speaker-inputs input:focus {
  outline: none;
  border-color: var(--primary, #2196F3);
  box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
}

.speaker-name {
  min-width: 150px;
}

.speaker-email {
  min-width: 200px;
}

.modal-actions {
  padding: 16px 24px;
  border-top: 1px solid var(--border-light, #e0e0e0);
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  background: var(--bg-subtle, #f9f9f9);
}

.modal-actions .button {
  padding: 8px 16px;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.modal-actions .button.primary {
  background: var(--primary, #2196F3);
  color: white;
  border: none;
}

.modal-actions .button.primary:hover {
  background: var(--primary-dark, #1976D2);
}

.modal-actions .button.secondary {
  background: white;
  color: var(--text-muted, #666);
  border: 1px solid var(--border, #ddd);
}

.modal-actions .button.secondary:hover {
  background: var(--bg-subtle, #f9f9f9);
}

/* Inline speaker button for notes */
.speaker-identify-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  margin: 8px 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.speaker-identify-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

/* Speaker tags in notes */
.speaker-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin: 8px 0;
}

.speaker-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  background: var(--primary-light, #E3F2FD);
  color: var(--primary, #2196F3);
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
}

.speaker-tag.has-email {
  background: var(--success-light, #E8F5E9);
  color: var(--success, #4CAF50);
}

/* Toast notification for speaker updates */
.toast.speaker-success {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .speaker-field {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .speaker-inputs input {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.15);
    color: white;
  }
  
  .speaker-inputs input::placeholder {
    color: rgba(255, 255, 255, 0.4);
  }
  
  .modal-header {
    border-bottom-color: rgba(255, 255, 255, 0.1);
  }
  
  .modal-actions {
    background: rgba(0, 0, 0, 0.2);
    border-top-color: rgba(255, 255, 255, 0.1);
  }
  
  .speaker-tag {
    background: rgba(33, 150, 243, 0.2);
  }
  
  .speaker-tag.has-email {
    background: rgba(76, 175, 80, 0.2);
  }
}

.speaker-rename-field { margin-bottom: 12px; }
.speaker-rename-field label { font-weight: 500; }
.speaker-rename-field input { width: 100%; background: var(--panel-2); border-color: var(--border); padding: 8px 10px; border-radius: 8px; }

@media (max-width: 780px) {
  .hub-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .insights-grid, .meetings-grid {
    grid-template-columns: 1fr;
  }

  .modal-content-wrapper {
    width: min(95vw, 900px);
    max-height: 90vh;
  }
}